import * as apiRequester from './apiRequester'
import moment from "moment";

export async function getTweets(user) {
    const numberOfTweets = getNumberOfTweets(user)
    const request = `http://localhost:7890/1.1/statuses/user_timeline.json?count=${numberOfTweets}&screen_name=${user}`
    const response = await apiRequester.send(request)
    const tweets = response.data || []
    const since = localStorage.getItem(`${user}_since`)
    const sinceTweets = tweets.filter(t => {
        const now = moment()
        const date = moment(t.created_at)
        return now.diff(date, 'minutes') < since
    })

    return sinceTweets
}

export async function getRetweets(id) {
    const request = `http://localhost:7890/1.1/statuses/retweets/${id}`
    const response = await apiRequester.send(request)

    return response ? response.data : []
}

export function getTweetLink(userId, id) {
    return `https://twitter.com/${userId}/status/${id}`
}

function getNumberOfTweets(user) {
    let numberOfTweets = localStorage.getItem(`${user}_numberOfTweets`)
    if (!numberOfTweets) {
        numberOfTweets = '10'
        localStorage.setItem(`${user}_numberOfTweets`, numberOfTweets)
    }

    return Number(numberOfTweets)
}